<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>Viagem.Log | Cadastrar Viagem</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/style.css">
</head>

<body>

    <div class="form-container">
        <h2>Cadastrar Viagem</h2>

        <form name="formCadastroViagem" id="formCadastroUsuario" enctype="multipart/form-data">
            <span>Destino</span>
            <input type="text" name="destino" required>

            <span>Data da Viagem</span>
            <input type="date" name="dtViagem" required>

            <span>Duração (em dias)</span>
            <input type="number" name="duracao" required min="1">

            <span>Companhia</span>
            <select name="companhia" required>
                <option value="">Selecione</option>
                <option value="sozinho">Sozinho</option>
                <option value="amigos">Amigos</option>
                <option value="familia">Família</option>
                <option value="conjuge">Cônjuge</option>
            </select>

            <span>Categoria</span>
            <select name="categoria" required>
                <option value="">Selecione</option>
                <option value="Praia">Praia</option>
                <option value="Cidade Grande">Cidade Grande</option>
                <option value="Natureza/Aventura">Natureza/Aventura</option>
                <option value="Histórico/Cultural">Histórico/Cultural</option>
            </select>

            <span>Comentário</span>
            <textarea name="comentario" rows="4" placeholder="Como foi sua viagem?" required></textarea>

            <span>Foto</span>
            <input type="file" name="fotoViagem" accept="image/*" required>

            <input type="hidden" name="idUsuario" id="idUsuario">

            <button type="button" onclick="autenticar()">Salvar Viagem</button>
        </form>
    </div>

    <script>
        function autenticar() {
            const destino = document.querySelector('input[name="destino"]');
            const dtViagem = document.querySelector('input[name="dtViagem"]');
            const duracao = document.querySelector('input[name="duracao"]');
            const companhia = document.querySelector('select[name="companhia"]');
            const categoria = document.querySelector('select[name="categoria"]');
            const comentario = document.querySelector('textarea[name="comentario"]');
            const foto = document.querySelector('input[name="fotoViagem"]');
            const idUsuario = document.getElementById("idUsuario");

            const formData = new FormData();
            formData.append("destino", destino.value);
            formData.append("dtViagem", dtViagem.value);
            formData.append("duracao", duracao.value);
            formData.append("companhia", companhia.value);
            formData.append("categoria", categoria.value);
            formData.append("comentario", comentario.value);
            formData.append("fotoViagem", foto.files[0]);
            formData.append("idUsuario", idUsuario.value);

            fetch("/viagens/cadastrar", {
                method: "POST",
                body: formData
            })
                .then(res => res.json())
                .then(data => {
                    alert(data.mensagem || data.erro);
                    if (!data.erro) document.getElementById("form-viagem").reset();
                })
                .catch(err => {
                    console.error("Erro ao enviar:", err);
                    alert("Erro no envio da viagem.");
                });
        }

        document.addEventListener("DOMContentLoaded", () => {
            const idUsuario = sessionStorage.getItem("id_usuario_logado");
            if (!idUsuario) {
                alert("Você precisa estar logado para cadastrar uma viagem.");
                window.location.href = "login.html";
            } else {
                document.getElementById("idUsuario").value = idUsuario;
            }
        });
    </script>

</body>

</html>
